<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard | Teach With Dost</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!-- Navbar -->
    <div id="navbar"></div>

    <div class="container mt-5 mb-5">
      <h3 class="text-center text-gradient mb-4">
        üëã Welcome to Your Dashboard
      </h3>

      <div class="row g-4">
        <!-- PROFILE CARD -->
        <div class="col-md-4">
          <div class="card shadow-lg p-4 auth-card dashboard-card">
            <img
              id="dashProfilePic"
              name="profile_pic"
              src="/uploads/male.png"
              class="rounded-circle mx-auto mb-3"
              width="110"
              height="110"
              alt="Profile"
            />

            <h5 id="dashName">User Name</h5>
            <p class="text-muted" id="dashEmail" name="">user@email.com</p>

            <a href="/profile" class="btn btn-outline-primary mt-2">
              Edit Profile
            </a>
          </div>
        </div>

        <!-- PERSONAL INFO -->
        <div class="col-md-8">
          <div class="card shadow-lg p-4 auth-card">
            <h5 class="mb-3">üìå Personal Information</h5>

            <div class="row">
              <div class="col-md-6 mb-2">
                <b>College:</b> <span id="dashCollege" name="college">‚Äî</span>
              </div>
              <div class="col-md-6 mb-2">
                <b>Mobile:</b> <span id="dashMobile" name="mobile">‚Äî</span>
              </div>
              <div class="col-md-6 mb-2">
                <b>City:</b> <span id="dashCity" name="city">‚Äî</span>
              </div>
              <div class="col-md-6 mb-2">
                <b>Career Goal:</b> <span id="dashCareer" name="career">‚Äî</span>
              </div>
              <div class="col-md-6 mb-2">
                <b>Date of Birth:</b> <span id="dashDob" name="dob">‚Äî</span>
              </div>
              <div class="col-md-6 mb-2">
                <b>Gender:</b> <span id="dashGender" name="gender">‚Äî</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ACTIVITY SUMMARY -->
        <div class="col-md-4">
          <div class="card shadow-lg p-4 text-center feature-card">
            <h6>üìò Notes Downloaded</h6>
            <h3 id="notesCount" class="stat-count" data-count="12">0</h3>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card shadow-lg p-4 text-center feature-card">
            <h6>üìù Assignments Downloaded</h6>
            <h3 id="assignmentCount" class="stat-count" data-count="6">0</h3>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card shadow-lg p-4 text-center feature-card">
            <h6>üß† Aptitude Tests Given</h6>
            <h3 id="testCount" class="stat-count" data-count="3">0</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer-section text-center">
      ¬© 2026 Teach With Dost | Learn Smart
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Load Navbar -->
    <script>
      fetch("/partials/nav.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("navbar").innerHTML = html;
          if (typeof loadUserInNavbar === "function") {
            loadUserInNavbar();
            initThemeToggle();
          }
        });
    </script>

    <!-- Dashboard JS -->
    <script>
      async function loadDashboard() {
        try {
          const res = await fetch("/api/dashboard");
          const data = await res.json();

          document.getElementById("dashName").innerText = data.name;
          document.getElementById("dashEmail").innerText = data.email;
          document.getElementById("dashCollege").innerText =
            data.college || "‚Äî";
          document.getElementById("dashMobile").innerText = data.mobile || "‚Äî";
          document.getElementById("dashCity").innerText = data.city || "‚Äî";
          document.getElementById("dashCareer").innerText = data.career || "‚Äî";
          if (data.dob) {
            const d = new Date(data.dob);
            const day = String(d.getDate()).padStart(2, "0");
            const month = String(d.getMonth() + 1).padStart(2, "0");
            const year = d.getFullYear();
            document.getElementById("dashDob").innerText =
              `${day}-${month}-${year}`;
          } else {
            document.getElementById("dashDob").innerText = "‚Äî";
          }

          document.getElementById("dashGender").innerText = data.gender || "‚Äî";

          document.getElementById("notesCount").innerText = data.notes || 0;
          document.getElementById("assignmentCount").innerText =
            data.assignments || 0;
          document.getElementById("testCount").innerText = data.tests || 0;

          const img =
            data.profile_pic && data.profile_pic.startsWith("/uploads")
              ? data.profile_pic
              : data.gender === "female"
                ? "/uploads/female.png"
                : "/uploads/male.png";

          document.getElementById("dashProfilePic").src = img;

          animateCounters();
        } catch (err) {
          console.error("Dashboard load error", err);
        }
      }
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", loadDashboard);
    </script>

    <script src="/js/main.js"></script>
    <script>
      function animateCounters() {
        document.querySelectorAll(".stat-count").forEach((el) => {
          const target = +el.dataset.count;
          let current = 0;
          const step = Math.ceil(target / 40);

          const timer = setInterval(() => {
            current += step;
            if (current >= target) {
              el.innerText = target;
              clearInterval(timer);
            } else {
              el.innerText = current;
            }
          }, 30);
        });
      }
    </script>
  </body>
</html>
